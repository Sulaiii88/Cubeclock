<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CubeClock</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>

  <style>
    /* === dein bestehendes Layout für den Würfel (unverändert) === */
    body{
      margin:0;background:#000;display:flex;flex-direction:column;justify-content:center;align-items:center;
      height:100vh;font-family:'Space Mono',monospace;overflow:hidden;touch-action:none;
    }
    .scene{width:63vmin;height:63vmin;perspective:1100px;margin-bottom:90px;}
    .cube{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 1s ease;transform:rotateX(-30deg) rotateY(45deg);}
    .face{
      position:absolute;width:100%;height:100%;
      background:linear-gradient(to bottom right,#000,#111);color:#fff;
      font-size:calc(63vmin / 1.5);letter-spacing:-5px;display:flex;justify-content:center;align-items:center;
      border:1px solid #555;backface-visibility:hidden;
    }
    .scene,.cube,.face{user-select:none;outline:none;}
    #hours{color:#e71f1b;} #minutes{color:#ff8c42;} #seconds{color:#fff275;}
    #year{color:#4B0082;} #day{color:#87c8fa;}
    #month{color:#2f4fba;font-size:calc(63vmin / 2);font-weight:bold;}
    .front{transform:rotateY( 90deg) translateZ(31.5vmin) rotateY(180deg) rotateX(180deg);}
    .back {transform:rotateY(180deg) translateZ(31.5vmin) rotateY(180deg) rotateX(180deg);}
    .right{transform:rotateY(  0deg) translateZ(31.5vmin);}
    .left {transform:rotateY(-90deg) translateZ(31.5vmin);}
    .top  {transform:rotateX( 90deg) translateZ(31.5vmin);}
    .bottom{transform:rotateX(-90deg) translateZ(31.5vmin);}

    /* Spacebar-Button (wie bei dir) */
    #toggleButton{
      position:fixed;left:50%;transform:translateX(-50%);bottom:5vh;
      padding:1px 100px;border:none;outline:none;box-shadow:none;border-radius:10px;background:#444;cursor:pointer;z-index:10;
    }
    #toggleButton:hover{background:#666;}
    #toggleButton img{width:30px;height:auto;display:block;}

    /* Desktop kleiner */
    @media (min-width:601px){
      .scene{width:50vmin;height:50vmin;}
      .face{font-size:calc(50vmin / 1.5);}
      #month{font-size:calc(50vmin / 2);}
      .front{transform:rotateY( 90deg) translateZ(25vmin) rotateY(180deg) rotateX(180deg);}
      .back {transform:rotateY(180deg) translateZ(25vmin) rotateY(180deg) rotateX(180deg);}
      .right{transform:rotateY(  0deg) translateZ(25vmin);}
      .left {transform:rotateY(-90deg) translateZ(25vmin);}
      .top  {transform:rotateX( 90deg) translateZ(25vmin);}
      .bottom{transform:rotateX(-90deg) translateZ(25vmin);}
    }
    /* installierte PWA auf Handy größer */
    @media (display-mode:standalone) and (max-width:600px){
      .scene{transform:scale(3);transform-origin:center;}
    }

    /* === NEU: Settings-UI genau wie Vorlage, aber mobil kleiner === */

    /* Overlay */
    #settingsOverlay{
      position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:saturate(120%) blur(2px);
      display:none;z-index:150;
    }

    /* Gear button (oben links, safe-area) */
    #settingsButton{
      position:fixed;
      top:calc(env(safe-area-inset-top,0px) + 12px);
      left:calc(env(safe-area-inset-left,0px) + 12px);
      width:44px;height:44px;padding:8px;background:#222;
      border:1px solid rgba(255,255,255,.08);border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.35);
      cursor:pointer;transition:transform .08s ease, background .2s ease, border-color .2s ease;z-index:200;
    }
    #settingsButton:hover{background:#2a2a2a;border-color:rgba(255,255,255,.14);}
    #settingsButton:active{transform:translateY(1px);}
    #settingsButton img{width:28px;height:28px;display:block;}

    /* Panel – responsive Breite & Typo */
    #settingsPanel{
      position:fixed;
      top:calc(env(safe-area-inset-top,0px) + 62px);
      left:calc(env(safe-area-inset-left,0px) + 12px);
      display:none;z-index:180;
      width:clamp(240px, 88vw, 340px);              /* ⬅︎ kleiner auf Handy, max 340px */
      max-height:calc(100vh - env(safe-area-inset-top,0px) - 90px);
      overflow:auto;
      background:#222;border:1px solid rgba(255,255,255,.10);border-radius:18px;
      color:#fff;box-shadow:0 18px 40px rgba(0,0,0,.5);
      padding:16px 14px 12px;
    }
    #settingsPanel h3{margin:0 0 12px;font-size:18px;color:#f1f1f1;letter-spacing:.5px;}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;font-size:16px;color:#eaeaea;margin:9px 0;}
    /* Farbfeld – exakt wie Vorlage, aber kompakter (Handy) */
    .color-input{
      width:52px;height:30px;appearance:none;-webkit-appearance:none;cursor:pointer;
      background:#000;border:4px solid #fff;border-radius:8px;
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.25);
    }
    .color-input::-webkit-color-swatch-wrapper{padding:0;border-radius:6px;}
    .color-input::-webkit-color-swatch{border:none;border-radius:6px;}

    .btn{
      display:block;width:100%;margin-top:10px;padding:10px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.1);background:#2b2b2b;color:#e8e8e8;font-size:15px;text-align:center;
      box-shadow:inset 0 -2px 0 rgba(255,255,255,.05), 0 2px 10px rgba(0,0,0,.25);
      transition:background .2s ease, transform .05s ease;
    }
    .btn:hover{background:#3a3a3a;}
    .btn:active{transform:translateY(1px);}

    /* Pfeil unter dem Zahnrad */
    #panelArrow{
      position:fixed;display:none;z-index:181;
      top:calc(env(safe-area-inset-top,0px) + 54px);
      left:calc(env(safe-area-inset-left,0px) + 36px);
      width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:12px solid #222;
      filter:drop-shadow(0 -1px 0 rgba(255,255,255,.08));
    }

    /* sehr kleine Phones noch kompakter */
    @media (max-width:360px){
      #settingsPanel{width:clamp(220px, 92vw, 300px);}
      #settingsPanel h3{font-size:17px}
      .row{font-size:15px}
      .color-input{width:48px;height:28px}
      .btn{font-size:14px}
    }
  </style>
</head>
<body>
  <div class="scene">
    <div class="cube" id="cube">
      <div class="face front"  id="year">00</div>
      <div class="face back"   id="month">00</div>
      <div class="face right"  id="seconds">00</div>
      <div class="face left"   id="minutes">00</div>
      <div class="face top"    id="hours">00</div>
      <div class="face bottom" id="day">00</div>
    </div>
  </div>

  <button id="toggleButton" onclick="toggleCube()">
    <img src="spacebar_icon.png" alt="spacebar" />
  </button>

  <!-- settings -->
  <button id="settingsButton" type="button" aria-label="Settings">
    <img src="settings.png" alt="Settings" />
  </button>
  <div id="panelArrow"></div>
  <div id="settingsOverlay"></div>

  <div id="settingsPanel" role="dialog" aria-label="Settings">
    <h3>Change colors</h3>

    <div class="row">Hour:        <input type="color" id="colorHours"   class="color-input"></div>
    <div class="row">Minute:      <input type="color" id="colorMinutes" class="color-input"></div>
    <div class="row">Second:      <input type="color" id="colorSeconds" class="color-input"></div>
    <div class="row">Year:        <input type="color" id="colorYear"    class="color-input"></div>
    <div class="row">Month:       <input type="color" id="colorMonth"   class="color-input"></div>
    <div class="row">Day:         <input type="color" id="colorDay"     class="color-input"></div>
    <div class="row">Cube faces:  <input type="color" id="colorCube"    class="color-input"></div>
    <div class="row">Background:  <input type="color" id="colorBackground" class="color-input"></div>

    <button class="btn" type="button" id="btnDefaults">Reset to defaults</button>
    <button class="btn" type="button" onclick="toggleCube()">Time/Date (space)</button>
    <button class="btn" type="button" id="closeSettingsBtn">Close</button>
  </div>

  <script>
    /* === Würfel-Logik wie bei dir === */
    let showingDate=false, rotateX=-30, rotateY=45, isDragging=false, lastX,lastY, userRotated=false, inactivityTimer, toggleCount=0;
    const cube=document.getElementById("cube");
    const toggleButton=document.getElementById("toggleButton");

    function updateTime(){
      const now=new Date(); const monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      hours.textContent  = String(now.getHours()).padStart(2,'0');
      minutes.textContent= String(now.getMinutes()).padStart(2,'0');
      seconds.textContent= String(now.getSeconds()).padStart(2,'0');
      year.textContent   = String(now.getFullYear()%100).padStart(2,'0');
      month.textContent  = monthNames[now.getMonth()];
      day.textContent    = String(now.getDate()).padStart(2,'0');
    }
    function toggleCube(){
      toggleCount++; if(toggleCount>=2) toggleButton.style.display="none";
      showingDate=!showingDate; rotateX=showingDate?-215:-30; rotateY=45;
      cube.style.transform=`rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
    }
    function resetToClockView(){
      if(showingDate||userRotated){ showingDate=false; userRotated=false; rotateX=-30; rotateY=45;
        cube.style.transform=`rotateX(${rotateX}deg) rotateY(${rotateY}deg)`; }
    }
    function startInactivityTimer(){ clearTimeout(inactivityTimer); inactivityTimer=setTimeout(resetToClockView,10000); }

    cube.addEventListener("mousedown",e=>{isDragging=true; lastX=e.clientX; lastY=e.clientY;});
    document.addEventListener("mouseup",()=>{isDragging=false;});
    document.addEventListener("mousemove",e=>{
      if(!isDragging) return;
      const dx=e.clientX-lastX, dy=e.clientY-lastY; lastX=e.clientX; lastY=e.clientY;
      rotateY+=dx*0.5; rotateX-=dy*0.5; cube.style.transform=`rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
      userRotated=true; startInactivityTimer();
    });

    document.body.addEventListener("touchstart",e=>{const t=e.touches[0]; lastX=t.clientX; lastY=t.clientY;});
    document.body.addEventListener("touchmove",e=>{
      e.preventDefault(); const t=e.touches[0];
      const dx=t.clientX-lastX, dy=t.clientY-lastY; lastX=t.clientX; lastY=t.clientY;
      rotateY+=dx*1; rotateX-=dy*1; cube.style.transform=`rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
      userRotated=true; startInactivityTimer();
    },{passive:false});

    window.addEventListener('keydown',e=>{
      if(e.code==='Space' && !e.target.matches('button, input, textarea')){ e.preventDefault(); toggleCube(); }
    });
    setInterval(updateTime,1000); updateTime();

    /* === Settings-Logik === */
    const settingsBtn=document.getElementById('settingsButton');
    const settingsPanel=document.getElementById('settingsPanel');
    const settingsOverlay=document.getElementById('settingsOverlay');
    const panelArrow=document.getElementById('panelArrow');
    const closeSettingsBtn=document.getElementById('closeSettingsBtn');
    const btnDefaults=document.getElementById('btnDefaults');

    function openSettings(){ settingsOverlay.style.display='block'; settingsPanel.style.display='block'; panelArrow.style.display='block'; }
    function closeSettings(){ settingsOverlay.style.display='none'; settingsPanel.style.display='none'; panelArrow.style.display='none'; }
    settingsBtn.addEventListener('click', ()=> (settingsPanel.style.display==='block'?closeSettings():openSettings()));
    settingsOverlay.addEventListener('click', closeSettings);
    closeSettingsBtn.addEventListener('click', closeSettings);

    const mapping={hours:"colorHours",minutes:"colorMinutes",seconds:"colorSeconds",year:"colorYear",month:"colorMonth",day:"colorDay",cube:"colorCube",background:"colorBackground"};
    const defaults={hours:"#e71f1b",minutes:"#ff8c42",seconds:"#fff275",year:"#4B0082",month:"#2f4fba",day:"#87c8fa",cube:"#111111",background:"#000000"};

    window.addEventListener('load',()=>{ if(!localStorage.getItem('visitedBefore')){localStorage.setItem('visitedBefore','true'); resetToDefaultColors();} else {applySavedColors();} });

    function applyColor(key,val){
      if(key==='cube'){ document.querySelectorAll('.face').forEach(f=>f.style.background=val); }
      else if(key==='background'){ document.body.style.background=val; }
      else{ document.getElementById(key).style.color=val; }
      localStorage.setItem('color-'+key,val);
    }
    Object.keys(mapping).forEach(key=>{
      const input=document.getElementById(mapping[key]);
      input.addEventListener('input',e=>applyColor(key,e.target.value));
    });

    function applySavedColors(){
      Object.keys(mapping).forEach(key=>{
        const input=document.getElementById(mapping[key]);
        const saved=localStorage.getItem('color-'+key);
        const val=saved || defaults[key];
        if(key==='cube'){ document.querySelectorAll('.face').forEach(f=>f.style.background=val); }
        else if(key==='background'){ document.body.style.background=val; }
        else{ document.getElementById(key).style.color=val; }
        input.value=val;
      });
    }
    function resetToDefaultColors(){
      Object.keys(mapping).forEach(key=>localStorage.removeItem('color-'+key));
      applySavedColors();
    }
    btnDefaults.addEventListener('click', resetToDefaultColors);
  </script>
</body>
</html>
